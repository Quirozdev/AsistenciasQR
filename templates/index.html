{% extends "base.html" %}
{% block title %}AsistenciasQR{% endblock %}
{% block head %}
{{super()}}
{% endblock %}
{% block body %}    
    {% if usuario.tipo_usuario != "Invitado" %}
        <h1>Hola {{usuario.nombre}} {{usuario.apellido_paterno}} {{usuario.apellido_materno}}!</h1>
        <p>{{mensaje}}</p>
        {% if usuario.tipo_usuario == 'Docente' %}
            <div class="dropdown">
                <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
                Crear grupo de asistencias
                </a>
                <div class="dropdown-menu">
                    <form class="px-4 py-3" action="" method="POST">
                    <div class="mb-3">
                        <label for="clave" class="form-label">Clave (Debe ser única y es la que será compartida con tus estudiantes para acceder al grupo)</label>
                        <input type="text" class="form-control" id="clave" name="clave" maxlength="254" required>
                    </div>
                    <div class="mb-3">
                        <label for="nombre_grupo" class="form-label">Nombre del grupo</label>
                        <input type="text" class="form-control" id="nombre_grupo" name="nombre_grupo" maxlength="254" required>
                    </div>
                    <div class="mb-3">
                        <label for="descripcion" class="form-label">Descripción del grupo</label>
                        <textarea rows="6" cols="48" id="descripcion" name="descripcion" class="form-control" placeholder="Este grupo es para..." maxlength="508" required></textarea>
                    </div>
                    <input type="submit" class="submitButton" name="crear_grupo" value="Crear">
                    </form>
                </div>
            </div>
            <label for="buscarGrupoPorNombre">Buscar grupo por nombre</label>
            <input type="text" id="buscarGrupoPorNombre" onkeyup="buscarGrupoPorNombre()" placeholder="Manejo de...">
            {% for grupo in grupos %}
                <div class="card">
                    <div class="card-header">
                        {{grupo.nombre}}
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">Clave de acceso: {{grupo.clave}}</h5>
                        <p class="card-text">{{grupo.descripcion}}</p>
                        <a href="/grupo/{{grupo.clave}}" class="btn btn-primary">Ir</a>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="dropdown">
                <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
                Unirse a un grupo de asistencias
                </a>
                <div class="dropdown-menu">
                    <form class="px-4 py-3" action="" method="POST">
                    <div class="mb-3">
                        <label for="clave" class="form-label">Clave del grupo</label>
                        <input type="text" class="form-control" id="clave" name="clave" maxlength="254" required>
                    </div>
                    <input type="submit" class="submitButton" name="unirse_grupo" value="Unirse">
                    </form>
                </div>
            </div>
            <label for="buscarGrupoPorNombre">Buscar grupo por nombre</label>
            <input type="text" id="buscarGrupoPorNombre" onkeyup="buscarGrupoPorNombre()" placeholder="Manejo de...">
            {% for grupo in grupos %}
            <div class="card">
                <div class="card-header">
                {{grupo.nombre}}
                </div>
                <div class="card-body">
                <h5 class="card-title">Propietario: {{grupo.nombre_propietario}} {{grupo.apellido_paterno_propietario}} {{grupo.apellido_materno_propietario}}</h5>
                <p class="card-text">{{grupo.descripcion}}</p>
                <a href="/grupo/{{grupo.clave}}" class="btn btn-primary">Ir</a>
                </div>
            </div>
            {% endfor %}
        {% endif %}
        <a href="/logout">Cerrar sesión</a>
        <script>
            function buscarGrupoPorNombre() {
                let input, filtro;
                // se obtienen los elementos de HTML
                input = document.getElementById("buscarGrupoPorNombre");
                filtro = input.value.toUpperCase();
                // se obtienen todas las cards donde viene la informacion de los grupos
                info_grupos = document.getElementsByClassName("card");
                for (let i = 0; i < info_grupos.length; i++) {
                    // de cada card se obtiene su primer div que tiene como clase card-header y es donde viene el nombre del grupo
                    div_nombre_grupo = info_grupos[i].getElementsByClassName("card-header")[0];
                    nombre_grupo = div_nombre_grupo.textContent || div_nombre_grupo.innerText;
                    // indexOf regresa la posicion de la primera ocurrencia de un string dentro de otro string,
                    // si no se encuentra un string dentro de otro, entonces regresa -1
                    // el valor del texto tambien se convierte a mayusculas para que no se fije si son mayusuculas o minusculas
                    // si el nombre del grupo en la card tiene dentro el filtro de busqueda (al ser mayor a -1 quiere decir que regreso una posicion valida del string interior)
                    if (nombre_grupo.toUpperCase().indexOf(filtro) > -1) {
                        // se deja tal cual
                        info_grupos[i].style.display = "";
                    } else {
                        // pero si no, se oculta la card
                        info_grupos[i].style.display = "none";
                    }
                }

            }
        </script>
    {% else %}
        <h1>Hola invitado!</h1>
        <p>Registrate <a href="/registro">aquí</a></p>
        <p>O Accede <a href="/login">aquí</a></p>
    {% endif %}
{% endblock %}